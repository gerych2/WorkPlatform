# API Documentation - Service Platform Belarus

## Обзор

Это полная документация по API для платформы услуг в Беларуси. Все API работают с базой данных PostgreSQL через Prisma ORM.

## Базовый URL

```
http://localhost:3000/api
```

## Аутентификация

### POST /api/auth/login
Вход в систему для зарегистрированных пользователей.

**Тело запроса:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Ответ:**
```json
{
  "success": true,
  "user": {
    "id": 1,
    "name": "Иван Иванов",
    "email": "user@example.com",
    "role": "client",
    "status": "active",
    "location": "Минск",
    "isVerified": true,
    "legalStatus": "ИП"
  }
}
```

**Проверки безопасности:**
- Пользователь должен существовать в базе данных
- Статус пользователя должен быть 'active' (не 'blocked' или 'pending')
- Пароль должен быть корректным
- Обновляется время последнего входа

### POST /api/auth/register
Регистрация новых пользователей.

**Тело запроса:**
```json
{
  "name": "Иван Иванов",
  "email": "user@example.com",
  "phone": "+375291234567",
  "password": "password123",
  "role": "executor",
  "location": "Минск",
  "legalStatus": "ИП"
}
```

**Ответ:**
```json
{
  "success": true,
  "message": "Регистрация успешна! Ожидайте подтверждения администратора.",
  "user": {
    "id": 1,
    "name": "Иван Иванов",
    "email": "user@example.com",
    "role": "executor",
    "status": "pending"
  }
}
```

**Валидация:**
- Все обязательные поля должны быть заполнены
- Email должен быть в корректном формате
- Пароль минимум 6 символов
- Проверка на существующий email
- Пароль хешируется с bcrypt

## Пользователи

### GET /api/users
Получение списка пользователей с фильтрацией.

**Параметры запроса:**
- `role` - фильтр по роли (client, executor, admin)
- `status` - фильтр по статусу (pending, active, blocked, verified)
- `limit` - количество записей на страницу (по умолчанию 50)
- `page` - номер страницы (по умолчанию 1)

**Ответ:**
```json
{
  "users": [...],
  "pagination": {
    "page": 1,
    "limit": 50,
    "total": 100,
    "pages": 2
  }
}
```

### GET /api/users/[id]
Получение конкретного пользователя с детальной информацией.

### PATCH /api/users/[id]
Обновление пользователя (для администраторов).

**Тело запроса:**
```json
{
  "status": "active",
  "isVerified": true,
  "role": "executor"
}
```

### DELETE /api/users/[id]
Удаление пользователя (каскадное удаление).

## Исполнители

### GET /api/executors
Получение списка исполнителей с профилями.

**Параметры запроса:**
- `category` - фильтр по категории услуг
- `location` - фильтр по местоположению
- `rating` - минимальный рейтинг
- `limit` - количество записей
- `page` - номер страницы

**Ответ:**
```json
{
  "executors": [
    {
      "id": 1,
      "name": "Иван Иванов",
      "location": "Минск",
      "executorProfile": {
        "rating": 4.8,
        "completedOrders": 25,
        "hourlyRate": 50.00
      },
      "_count": {
        "executorReviews": 15
      }
    }
  ],
  "pagination": {...}
}
```

### GET /api/executor-profile?userId=[id]
Получение профиля исполнителя.

### POST /api/executor-profile
Создание/обновление профиля исполнителя.

**Тело запроса:**
```json
{
  "userId": 1,
  "description": "Опытный электрик",
  "experience": "5 лет",
  "hourlyRate": 50.00,
  "categories": [1, 2, 3],
  "workingHours": {"monday": "9:00-18:00"},
  "responseTime": "2 часа"
}
```

## Категории услуг

### GET /api/categories
Получение всех активных категорий, отсортированных по популярности.

### POST /api/categories
Создание новой категории (для администраторов).

**Тело запроса:**
```json
{
  "name": "Электрика",
  "description": "Электромонтажные работы",
  "icon": "⚡"
}
```

### PATCH /api/categories
Обновление категории.

### DELETE /api/categories/[id]
Удаление категории (только если нет активных заказов).

## Заказы

### GET /api/orders
Получение списка заказов с фильтрацией.

**Параметры запроса:**
- `status` - статус заказа
- `categoryId` - ID категории
- `clientId` - ID клиента
- `executorId` - ID исполнителя

### POST /api/orders
Создание нового заказа.

**Тело запроса:**
```json
{
  "clientId": 1,
  "categoryId": 1,
  "serviceDescription": "Ремонт электрики",
  "address": "ул. Ленина, 15",
  "phone": "+375291234567",
  "clientName": "Иван Иванов",
  "notes": "Срочно",
  "orderDate": "2024-12-26",
  "orderTime": "14:00:00",
  "totalPrice": 120.00
}
```

### GET /api/orders/[id]
Получение конкретного заказа.

### PATCH /api/orders/[id]
Обновление заказа (статус, исполнитель, заметки).

### DELETE /api/orders/[id]
Удаление заказа.

## Поиск исполнителей

### GET /api/search/executors
Расширенный поиск исполнителей с множественными фильтрами.

**Параметры запроса:**
- `query` - текстовый поиск
- `category` - категория услуг
- `location` - местоположение
- `minRating` - минимальный рейтинг
- `maxPrice` - максимальная цена за час
- `sortBy` - сортировка (rating, price, experience, recent)
- `order` - порядок сортировки (asc, desc)

## Отзывы

### GET /api/reviews
Получение отзывов с фильтрацией.

### POST /api/reviews
Создание нового отзыва.

**Тело запроса:**
```json
{
  "orderId": 1,
  "clientId": 1,
  "executorId": 2,
  "rating": 5,
  "comment": "Отличная работа!"
}
```

**Автоматически:**
- Обновляется рейтинг исполнителя
- Увеличивается счетчик отзывов

## Уведомления

### GET /api/notifications?userId=[id]
Получение уведомлений пользователя.

### POST /api/notifications
Создание уведомления.

### PATCH /api/notifications
Отметка уведомлений как прочитанных.

## Жалобы

### GET /api/complaints
Получение списка жалоб.

### POST /api/complaints
Создание жалобы.

### PATCH /api/complaints
Обновление статуса жалобы (для администраторов).

## Подписки

### GET /api/subscriptions
Получение списка подписок.

### POST /api/subscriptions
Создание подписки.

### PATCH /api/subscriptions
Обновление подписки.

## Документы исполнителей

### GET /api/executor-documents
Получение документов исполнителей.

### POST /api/executor-documents
Загрузка документа исполнителя.

### PATCH /api/executor-documents
Верификация документа (для администраторов).

## Статистика

### GET /api/stats
Общая статистика платформы.

**Ответ:**
```json
{
  "overview": {
    "totalUsers": 150,
    "totalExecutors": 45,
    "totalClients": 105,
    "totalOrders": 320,
    "totalCategories": 12,
    "totalReviews": 180,
    "pendingUsers": 8,
    "activeOrders": 25
  },
  "topCategories": [...],
  "topExecutors": [...],
  "monthlyStats": [...]
}
```

## Коды ответов

- `200` - Успешный запрос
- `201` - Создано
- `400` - Ошибка валидации
- `401` - Не авторизован
- `403` - Доступ запрещен
- `404` - Не найдено
- `500` - Внутренняя ошибка сервера

## Безопасность

- Все пароли хешируются с bcrypt
- Проверка статуса пользователя при входе
- Валидация всех входных данных
- Проверка прав доступа для административных операций
- Защита от SQL-инъекций через Prisma

## Пагинация

Все API с множественными результатами поддерживают пагинацию:
- `limit` - количество записей на страницу
- `page` - номер страницы
- `total` - общее количество записей
- `pages` - общее количество страниц

## Фильтрация

Большинство API поддерживают фильтрацию по различным параметрам:
- По статусу
- По роли пользователя
- По категории
- По местоположению
- По рейтингу
- По цене
- По дате

## Сортировка

API поддерживают различные варианты сортировки:
- По рейтингу
- По цене
- По опыту
- По дате регистрации
- По количеству заказов
