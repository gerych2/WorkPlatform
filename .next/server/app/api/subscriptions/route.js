"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/subscriptions/route";
exports.ids = ["app/api/subscriptions/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsubscriptions%2Froute&page=%2Fapi%2Fsubscriptions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsubscriptions%2Froute.ts&appDir=D%3A%5Cmobile%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Cmobile&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsubscriptions%2Froute&page=%2Fapi%2Fsubscriptions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsubscriptions%2Froute.ts&appDir=D%3A%5Cmobile%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Cmobile&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var D_mobile_app_api_subscriptions_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/subscriptions/route.ts */ \"(rsc)/./app/api/subscriptions/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/subscriptions/route\",\n        pathname: \"/api/subscriptions\",\n        filename: \"route\",\n        bundlePath: \"app/api/subscriptions/route\"\n    },\n    resolvedPagePath: \"D:\\\\mobile\\\\app\\\\api\\\\subscriptions\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_mobile_app_api_subscriptions_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/subscriptions/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZzdWJzY3JpcHRpb25zJTJGcm91dGUmcGFnZT0lMkZhcGklMkZzdWJzY3JpcHRpb25zJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGc3Vic2NyaXB0aW9ucyUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDbW9iaWxlJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1EJTNBJTVDbW9iaWxlJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ0g7QUFDMUU7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSx1R0FBdUc7QUFDL0c7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUM2Sjs7QUFFN0oiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wcm9kby1hZ2VuY3kvPzFhNWUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiRDpcXFxcbW9iaWxlXFxcXGFwcFxcXFxhcGlcXFxcc3Vic2NyaXB0aW9uc1xcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc3Vic2NyaXB0aW9ucy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3N1YnNjcmlwdGlvbnNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3N1YnNjcmlwdGlvbnMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJEOlxcXFxtb2JpbGVcXFxcYXBwXFxcXGFwaVxcXFxzdWJzY3JpcHRpb25zXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIGhlYWRlckhvb2tzLCBzdGF0aWNHZW5lcmF0aW9uQmFpbG91dCB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3N1YnNjcmlwdGlvbnMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsubscriptions%2Froute&page=%2Fapi%2Fsubscriptions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsubscriptions%2Froute.ts&appDir=D%3A%5Cmobile%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Cmobile&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/subscriptions/route.ts":
/*!****************************************!*\
  !*** ./app/api/subscriptions/route.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   PATCH: () => (/* binding */ PATCH),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_serverUtils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/serverUtils */ \"(rsc)/./lib/serverUtils.ts\");\n\n\n\nconst prisma = new _prisma_client__WEBPACK_IMPORTED_MODULE_1__.PrismaClient();\n// Получение подписок пользователя\nasync function GET(request) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const userId = searchParams.get(\"userId\");\n        if (!userId) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"User ID is required\"\n            }, {\n                status: 400\n            });\n        }\n        const subscriptions = await prisma.subscription.findMany({\n            where: {\n                userId: parseInt(userId)\n            },\n            orderBy: {\n                createdAt: \"desc\"\n            }\n        });\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            subscriptions\n        });\n    } catch (error) {\n        console.error(\"Error fetching subscriptions:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to fetch subscriptions\"\n        }, {\n            status: 500\n        });\n    }\n}\n// Создание новой подписки\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        const { userId, planType, amount, paymentMethod } = body;\n        // Получаем текущего пользователя\n        const authHeader = request.headers.get(\"authorization\");\n        const userData = (0,_lib_serverUtils__WEBPACK_IMPORTED_MODULE_2__.getUserDataFromToken)(authHeader);\n        if (!userData) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        if (userData.id !== parseInt(userId)) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        // Проверяем, что пользователь является исполнителем\n        if (userData.role !== \"executor\") {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Only executors can create subscriptions\"\n            }, {\n                status: 403\n            });\n        }\n        // Проверяем, что пользователь существует в базе данных\n        const user = await prisma.user.findUnique({\n            where: {\n                id: parseInt(userId)\n            }\n        });\n        if (!user) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"User not found\"\n            }, {\n                status: 404\n            });\n        }\n        // Определяем длительность подписки\n        let durationDays = 1;\n        switch(planType){\n            case \"daily\":\n                durationDays = 1;\n                break;\n            case \"weekly\":\n                durationDays = 7;\n                break;\n            case \"monthly\":\n                durationDays = 30;\n                break;\n            default:\n                return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                    error: \"Invalid plan type\"\n                }, {\n                    status: 400\n                });\n        }\n        // Вычисляем даты начала и окончания\n        const startDate = new Date();\n        const endDate = new Date();\n        endDate.setDate(endDate.getDate() + durationDays);\n        // Отменяем все активные подписки пользователя\n        await prisma.subscription.updateMany({\n            where: {\n                userId: parseInt(userId),\n                status: \"active\"\n            },\n            data: {\n                status: \"cancelled\"\n            }\n        });\n        // Создаем новую подписку\n        const subscription = await prisma.subscription.create({\n            data: {\n                userId: parseInt(userId),\n                planType,\n                startDate,\n                endDate,\n                amount: parseFloat(amount),\n                status: \"active\",\n                paymentMethod: paymentMethod || \"demo\"\n            }\n        });\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            message: \"Subscription created successfully\",\n            subscription\n        });\n    } catch (error) {\n        console.error(\"Error creating subscription:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to create subscription\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function PATCH(request) {\n    try {\n        const body = await request.json();\n        const { id, status, endDate, amount } = body;\n        if (!id) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"ID подписки обязателен\"\n            }, {\n                status: 400\n            });\n        }\n        // Проверяем, существует ли подписка\n        const existingSubscription = await prisma.subscription.findUnique({\n            where: {\n                id: parseInt(id)\n            }\n        });\n        if (!existingSubscription) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Подписка не найдена\"\n            }, {\n                status: 404\n            });\n        }\n        // Обновляем подписку\n        const updatedSubscription = await prisma.subscription.update({\n            where: {\n                id: parseInt(id)\n            },\n            data: {\n                ...status && {\n                    status\n                },\n                ...endDate && {\n                    endDate: new Date(endDate)\n                },\n                ...amount && {\n                    amount: parseFloat(amount)\n                }\n            },\n            include: {\n                user: {\n                    select: {\n                        id: true,\n                        name: true,\n                        email: true\n                    }\n                }\n            }\n        });\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            message: \"Подписка успешно обновлена\",\n            subscription: updatedSubscription\n        });\n    } catch (error) {\n        console.error(\"Error updating subscription:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Ошибка при обновлении подписки\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TzlDLGtGQUFZQSxDQUFDVyxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQXNCLEdBQy9CO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxxQkFBcUI7UUFDckIsTUFBTWtDLHNCQUFzQixNQUFNNUMsT0FBT1ksWUFBWSxDQUFDaUMsTUFBTSxDQUFDO1lBQzNEL0IsT0FBTztnQkFBRWEsSUFBSVosU0FBU1k7WUFBSTtZQUMxQlcsTUFBTTtnQkFDSixHQUFJNUIsVUFBVTtvQkFBRUE7Z0JBQU8sQ0FBQztnQkFDeEIsR0FBSXdCLFdBQVc7b0JBQUVBLFNBQVMsSUFBSUQsS0FBS0M7Z0JBQVMsQ0FBQztnQkFDN0MsR0FBSVosVUFBVTtvQkFBRUEsUUFBUWtCLFdBQVdsQjtnQkFBUSxDQUFDO1lBQzlDO1lBQ0F3QixTQUFTO2dCQUNQakIsTUFBTTtvQkFDSmtCLFFBQVE7d0JBQ05wQixJQUFJO3dCQUNKcUIsTUFBTTt3QkFDTkMsT0FBTztvQkFDVDtnQkFDRjtZQUNGO1FBQ0Y7UUFFQSxPQUFPcEQsa0ZBQVlBLENBQUNXLElBQUksQ0FBQztZQUN2QjBDLFNBQVM7WUFDVFQsU0FBUztZQUNUN0IsY0FBY2dDO1FBQ2hCO0lBRUYsRUFBRSxPQUFPbkMsT0FBTztRQUNkUyxRQUFRVCxLQUFLLENBQUMsZ0NBQWdDQTtRQUM5QyxPQUFPWixrRkFBWUEsQ0FBQ1csSUFBSSxDQUN0QjtZQUFFQyxPQUFPO1FBQWlDLEdBQzFDO1lBQUVDLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHJvZG8tYWdlbmN5Ly4vYXBwL2FwaS9zdWJzY3JpcHRpb25zL3JvdXRlLnRzPzM4M2MiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnXG5pbXBvcnQgeyBnZXRVc2VyRGF0YUZyb21Ub2tlbiB9IGZyb20gJy4uLy4uLy4uL2xpYi9zZXJ2ZXJVdGlscydcblxuY29uc3QgcHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpXG5cbi8vINCf0L7Qu9GD0YfQtdC90LjQtSDQv9C+0LTQv9C40YHQvtC6INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRj1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKVxuICAgIGNvbnN0IHVzZXJJZCA9IHNlYXJjaFBhcmFtcy5nZXQoJ3VzZXJJZCcpXG5cbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdVc2VyIElEIGlzIHJlcXVpcmVkJyB9LCB7IHN0YXR1czogNDAwIH0pXG4gICAgfVxuXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9ucyA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uZmluZE1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgdXNlcklkOiBwYXJzZUludCh1c2VySWQpXG4gICAgICB9LFxuICAgICAgb3JkZXJCeToge1xuICAgICAgICBjcmVhdGVkQXQ6ICdkZXNjJ1xuICAgICAgfVxuICAgIH0pXG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBzdWJzY3JpcHRpb25zIH0pXG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBzdWJzY3JpcHRpb25zOicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdGYWlsZWQgdG8gZmV0Y2ggc3Vic2NyaXB0aW9ucycgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufVxuXG4vLyDQodC+0LfQtNCw0L3QuNC1INC90L7QstC+0Lkg0L/QvtC00L/QuNGB0LrQuFxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcbiAgICBjb25zdCB7IHVzZXJJZCwgcGxhblR5cGUsIGFtb3VudCwgcGF5bWVudE1ldGhvZCB9ID0gYm9keVxuXG4gICAgLy8g0J/QvtC70YPRh9Cw0LXQvCDRgtC10LrRg9GJ0LXQs9C+INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRj1xuICAgIGNvbnN0IGF1dGhIZWFkZXIgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCdhdXRob3JpemF0aW9uJylcbiAgICBjb25zdCB1c2VyRGF0YSA9IGdldFVzZXJEYXRhRnJvbVRva2VuKGF1dGhIZWFkZXIpXG5cbiAgICBpZiAoIXVzZXJEYXRhKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSwgeyBzdGF0dXM6IDQwMSB9KVxuICAgIH1cblxuICAgIGlmICh1c2VyRGF0YS5pZCAhPT0gcGFyc2VJbnQodXNlcklkKSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0sIHsgc3RhdHVzOiA0MDEgfSlcbiAgICB9XG5cbiAgICAvLyDQn9GA0L7QstC10YDRj9C10LwsINGH0YLQviDQv9C+0LvRjNC30L7QstCw0YLQtdC70Ywg0Y/QstC70Y/QtdGC0YHRjyDQuNGB0L/QvtC70L3QuNGC0LXQu9C10LxcbiAgICBpZiAodXNlckRhdGEucm9sZSAhPT0gJ2V4ZWN1dG9yJykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdPbmx5IGV4ZWN1dG9ycyBjYW4gY3JlYXRlIHN1YnNjcmlwdGlvbnMnIH0sIHsgc3RhdHVzOiA0MDMgfSlcbiAgICB9XG5cbiAgICAvLyDQn9GA0L7QstC10YDRj9C10LwsINGH0YLQviDQv9C+0LvRjNC30L7QstCw0YLQtdC70Ywg0YHRg9GJ0LXRgdGC0LLRg9C10YIg0LIg0LHQsNC30LUg0LTQsNC90L3Ri9GFXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IHBhcnNlSW50KHVzZXJJZCkgfVxuICAgIH0pXG5cbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnVXNlciBub3QgZm91bmQnIH0sIHsgc3RhdHVzOiA0MDQgfSlcbiAgICB9XG5cbiAgICAvLyDQntC/0YDQtdC00LXQu9GP0LXQvCDQtNC70LjRgtC10LvRjNC90L7RgdGC0Ywg0L/QvtC00L/QuNGB0LrQuFxuICAgIGxldCBkdXJhdGlvbkRheXMgPSAxXG4gICAgc3dpdGNoIChwbGFuVHlwZSkge1xuICAgICAgY2FzZSAnZGFpbHknOlxuICAgICAgICBkdXJhdGlvbkRheXMgPSAxXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICd3ZWVrbHknOlxuICAgICAgICBkdXJhdGlvbkRheXMgPSA3XG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlICdtb250aGx5JzpcbiAgICAgICAgZHVyYXRpb25EYXlzID0gMzBcbiAgICAgICAgYnJlYWtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnSW52YWxpZCBwbGFuIHR5cGUnIH0sIHsgc3RhdHVzOiA0MDAgfSlcbiAgICB9XG5cbiAgICAvLyDQktGL0YfQuNGB0LvRj9C10Lwg0LTQsNGC0Ysg0L3QsNGH0LDQu9CwINC4INC+0LrQvtC90YfQsNC90LjRj1xuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKClcbiAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUoKVxuICAgIGVuZERhdGUuc2V0RGF0ZShlbmREYXRlLmdldERhdGUoKSArIGR1cmF0aW9uRGF5cylcblxuICAgIC8vINCe0YLQvNC10L3Rj9C10Lwg0LLRgdC1INCw0LrRgtC40LLQvdGL0LUg0L/QvtC00L/QuNGB0LrQuCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y9cbiAgICBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLnVwZGF0ZU1hbnkoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgdXNlcklkOiBwYXJzZUludCh1c2VySWQpLFxuICAgICAgICBzdGF0dXM6ICdhY3RpdmUnXG4gICAgICB9LFxuICAgICAgZGF0YToge1xuICAgICAgICBzdGF0dXM6ICdjYW5jZWxsZWQnXG4gICAgICB9XG4gICAgfSlcblxuICAgIC8vINCh0L7Qt9C00LDQtdC8INC90L7QstGD0Y4g0L/QvtC00L/QuNGB0LrRg1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdXNlcklkOiBwYXJzZUludCh1c2VySWQpLFxuICAgICAgICBwbGFuVHlwZSxcbiAgICAgICAgc3RhcnREYXRlLFxuICAgICAgICBlbmREYXRlLFxuICAgICAgICBhbW91bnQ6IHBhcnNlRmxvYXQoYW1vdW50KSxcbiAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgICAgcGF5bWVudE1ldGhvZDogcGF5bWVudE1ldGhvZCB8fCAnZGVtbydcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIG1lc3NhZ2U6ICdTdWJzY3JpcHRpb24gY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgc3Vic2NyaXB0aW9uXG4gICAgfSlcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIHN1YnNjcmlwdGlvbjonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIGNyZWF0ZSBzdWJzY3JpcHRpb24nIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBBVENIKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKClcbiAgICBjb25zdCB7IGlkLCBzdGF0dXMsIGVuZERhdGUsIGFtb3VudCB9ID0gYm9keVxuXG4gICAgaWYgKCFpZCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnSUQg0L/QvtC00L/QuNGB0LrQuCDQvtCx0Y/Qt9Cw0YLQtdC70LXQvScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8g0J/RgNC+0LLQtdGA0Y/QtdC8LCDRgdGD0YnQtdGB0YLQstGD0LXRgiDQu9C4INC/0L7QtNC/0LjRgdC60LBcbiAgICBjb25zdCBleGlzdGluZ1N1YnNjcmlwdGlvbiA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBpZDogcGFyc2VJbnQoaWQpIH1cbiAgICB9KVxuXG4gICAgaWYgKCFleGlzdGluZ1N1YnNjcmlwdGlvbikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAn0J/QvtC00L/QuNGB0LrQsCDQvdC1INC90LDQudC00LXQvdCwJyB9LFxuICAgICAgICB7IHN0YXR1czogNDA0IH1cbiAgICAgIClcbiAgICB9XG5cbiAgICAvLyDQntCx0L3QvtCy0LvRj9C10Lwg0L/QvtC00L/QuNGB0LrRg1xuICAgIGNvbnN0IHVwZGF0ZWRTdWJzY3JpcHRpb24gPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLnVwZGF0ZSh7XG4gICAgICB3aGVyZTogeyBpZDogcGFyc2VJbnQoaWQpIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIC4uLihzdGF0dXMgJiYgeyBzdGF0dXMgfSksXG4gICAgICAgIC4uLihlbmREYXRlICYmIHsgZW5kRGF0ZTogbmV3IERhdGUoZW5kRGF0ZSkgfSksXG4gICAgICAgIC4uLihhbW91bnQgJiYgeyBhbW91bnQ6IHBhcnNlRmxvYXQoYW1vdW50KSB9KVxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICBuYW1lOiB0cnVlLFxuICAgICAgICAgICAgZW1haWw6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAn0J/QvtC00L/QuNGB0LrQsCDRg9GB0L/QtdGI0L3QviDQvtCx0L3QvtCy0LvQtdC90LAnLFxuICAgICAgc3Vic2NyaXB0aW9uOiB1cGRhdGVkU3Vic2NyaXB0aW9uXG4gICAgfSlcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHN1YnNjcmlwdGlvbjonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAn0J7RiNC40LHQutCwINC/0YDQuCDQvtCx0L3QvtCy0LvQtdC90LjQuCDQv9C+0LTQv9C40YHQutC4JyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiUHJpc21hQ2xpZW50IiwiZ2V0VXNlckRhdGFGcm9tVG9rZW4iLCJwcmlzbWEiLCJHRVQiLCJyZXF1ZXN0Iiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwidXNlcklkIiwiZ2V0IiwianNvbiIsImVycm9yIiwic3RhdHVzIiwic3Vic2NyaXB0aW9ucyIsInN1YnNjcmlwdGlvbiIsImZpbmRNYW55Iiwid2hlcmUiLCJwYXJzZUludCIsIm9yZGVyQnkiLCJjcmVhdGVkQXQiLCJjb25zb2xlIiwiUE9TVCIsImJvZHkiLCJwbGFuVHlwZSIsImFtb3VudCIsInBheW1lbnRNZXRob2QiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsInVzZXJEYXRhIiwiaWQiLCJyb2xlIiwidXNlciIsImZpbmRVbmlxdWUiLCJkdXJhdGlvbkRheXMiLCJzdGFydERhdGUiLCJEYXRlIiwiZW5kRGF0ZSIsInNldERhdGUiLCJnZXREYXRlIiwidXBkYXRlTWFueSIsImRhdGEiLCJjcmVhdGUiLCJwYXJzZUZsb2F0IiwibWVzc2FnZSIsIlBBVENIIiwiZXhpc3RpbmdTdWJzY3JpcHRpb24iLCJ1cGRhdGVkU3Vic2NyaXB0aW9uIiwidXBkYXRlIiwiaW5jbHVkZSIsInNlbGVjdCIsIm5hbWUiLCJlbWFpbCIsInN1Y2Nlc3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/subscriptions/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/serverUtils.ts":
/*!****************************!*\
  !*** ./lib/serverUtils.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getUserDataFromToken: () => (/* binding */ getUserDataFromToken),\n/* harmony export */   safeBase64Decode: () => (/* binding */ safeBase64Decode)\n/* harmony export */ });\n/* harmony import */ var buffer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! buffer */ \"buffer\");\n/* harmony import */ var buffer__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(buffer__WEBPACK_IMPORTED_MODULE_0__);\n\n// Безопасное декодирование из base64 для UTF-8 строк на сервере\nfunction safeBase64Decode(str) {\n    try {\n        // Сначала декодируем из base64, затем из UTF-8\n        return buffer__WEBPACK_IMPORTED_MODULE_0__.Buffer.from(str, \"base64\").toString(\"utf-8\");\n    } catch (error) {\n        console.error(\"Error decoding from base64:\", error);\n        // Fallback: используем простой Buffer для ASCII строк\n        return buffer__WEBPACK_IMPORTED_MODULE_0__.Buffer.from(str, \"base64\").toString(\"ascii\");\n    }\n}\n// Извлечение данных пользователя из токена авторизации\nfunction getUserDataFromToken(authHeader) {\n    if (!authHeader) {\n        return null;\n    }\n    try {\n        const token = authHeader.replace(\"Bearer \", \"\");\n        const userDataString = safeBase64Decode(token);\n        return JSON.parse(userDataString);\n    } catch (error) {\n        console.error(\"Error parsing user data from token:\", error);\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc2VydmVyVXRpbHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUErQjtBQUUvQixnRUFBZ0U7QUFDekQsU0FBU0MsaUJBQWlCQyxHQUFXO0lBQzFDLElBQUk7UUFDRiwrQ0FBK0M7UUFDL0MsT0FBT0YsMENBQU1BLENBQUNHLElBQUksQ0FBQ0QsS0FBSyxVQUFVRSxRQUFRLENBQUM7SUFDN0MsRUFBRSxPQUFPQyxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQywrQkFBK0JBO1FBQzdDLHNEQUFzRDtRQUN0RCxPQUFPTCwwQ0FBTUEsQ0FBQ0csSUFBSSxDQUFDRCxLQUFLLFVBQVVFLFFBQVEsQ0FBQztJQUM3QztBQUNGO0FBRUEsdURBQXVEO0FBQ2hELFNBQVNHLHFCQUFxQkMsVUFBeUI7SUFDNUQsSUFBSSxDQUFDQSxZQUFZO1FBQ2YsT0FBTztJQUNUO0lBRUEsSUFBSTtRQUNGLE1BQU1DLFFBQVFELFdBQVdFLE9BQU8sQ0FBQyxXQUFXO1FBQzVDLE1BQU1DLGlCQUFpQlYsaUJBQWlCUTtRQUN4QyxPQUFPRyxLQUFLQyxLQUFLLENBQUNGO0lBQ3BCLEVBQUUsT0FBT04sT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsdUNBQXVDQTtRQUNyRCxPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3Byb2RvLWFnZW5jeS8uL2xpYi9zZXJ2ZXJVdGlscy50cz85YWViIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJ1ZmZlciB9IGZyb20gJ2J1ZmZlcidcclxuXHJcbi8vINCR0LXQt9C+0L/QsNGB0L3QvtC1INC00LXQutC+0LTQuNGA0L7QstCw0L3QuNC1INC40LcgYmFzZTY0INC00LvRjyBVVEYtOCDRgdGC0YDQvtC6INC90LAg0YHQtdGA0LLQtdGA0LVcclxuZXhwb3J0IGZ1bmN0aW9uIHNhZmVCYXNlNjREZWNvZGUoc3RyOiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gIHRyeSB7XHJcbiAgICAvLyDQodC90LDRh9Cw0LvQsCDQtNC10LrQvtC00LjRgNGD0LXQvCDQuNC3IGJhc2U2NCwg0LfQsNGC0LXQvCDQuNC3IFVURi04XHJcbiAgICByZXR1cm4gQnVmZmVyLmZyb20oc3RyLCAnYmFzZTY0JykudG9TdHJpbmcoJ3V0Zi04JylcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZGVjb2RpbmcgZnJvbSBiYXNlNjQ6JywgZXJyb3IpXHJcbiAgICAvLyBGYWxsYmFjazog0LjRgdC/0L7Qu9GM0LfRg9C10Lwg0L/RgNC+0YHRgtC+0LkgQnVmZmVyINC00LvRjyBBU0NJSSDRgdGC0YDQvtC6XHJcbiAgICByZXR1cm4gQnVmZmVyLmZyb20oc3RyLCAnYmFzZTY0JykudG9TdHJpbmcoJ2FzY2lpJylcclxuICB9XHJcbn1cclxuXHJcbi8vINCY0LfQstC70LXRh9C10L3QuNC1INC00LDQvdC90YvRhSDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8g0LjQtyDRgtC+0LrQtdC90LAg0LDQstGC0L7RgNC40LfQsNGG0LjQuFxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlckRhdGFGcm9tVG9rZW4oYXV0aEhlYWRlcjogc3RyaW5nIHwgbnVsbCkge1xyXG4gIGlmICghYXV0aEhlYWRlcikge1xyXG4gICAgcmV0dXJuIG51bGxcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB0b2tlbiA9IGF1dGhIZWFkZXIucmVwbGFjZSgnQmVhcmVyICcsICcnKVxyXG4gICAgY29uc3QgdXNlckRhdGFTdHJpbmcgPSBzYWZlQmFzZTY0RGVjb2RlKHRva2VuKVxyXG4gICAgcmV0dXJuIEpTT04ucGFyc2UodXNlckRhdGFTdHJpbmcpXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHBhcnNpbmcgdXNlciBkYXRhIGZyb20gdG9rZW46JywgZXJyb3IpXHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxufVxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIl0sIm5hbWVzIjpbIkJ1ZmZlciIsInNhZmVCYXNlNjREZWNvZGUiLCJzdHIiLCJmcm9tIiwidG9TdHJpbmciLCJlcnJvciIsImNvbnNvbGUiLCJnZXRVc2VyRGF0YUZyb21Ub2tlbiIsImF1dGhIZWFkZXIiLCJ0b2tlbiIsInJlcGxhY2UiLCJ1c2VyRGF0YVN0cmluZyIsIkpTT04iLCJwYXJzZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/serverUtils.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fsubscriptions%2Froute&page=%2Fapi%2Fsubscriptions%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fsubscriptions%2Froute.ts&appDir=D%3A%5Cmobile%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5Cmobile&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();